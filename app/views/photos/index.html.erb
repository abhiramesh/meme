<% if @myfriendphotos != [] %>
	<div id="masonry-container" class="transitions-enabled infinite-scroll clearfix">
		<% @myfriendphotos.first(20).each do |p| %>
		    <div class="box col2">
				<%= link_to image_tag(p.src), new_meme_path(:photo_id => p.id) %>
			</div>
		<% end %>
	</div>
<% else %>
<div class="container" align="center">
	<img src="/assets/loading.gif">
</div>
<% end %>


<% if @user.sign_in_count == 1 %>
<script type="text/javascript">
$(document).ready(function(){
	worker();
function worker(){
	$.ajax({
		type: "GET",
		url: '/all_photos',
		dataType: "json",
		complete: function(response) {
			var contains = (window.location.href.indexOf('#loaded') > -1);
			if (response.responseText == "yes"){
				if(contains != true){
					window.location = window.location + "#loaded";
					window.location.reload();	
				};
				
			};
			if (response.responseText == "no"){
				setTimeout(worker, 1000);
				console.log(response.responseText);
			};
		}
	});	
};
</script>
<% end %>


<script type="text/javascript">
// $(document).ready(function(){
// 	$('#masonry-container').masonry({
// 	  itemSelector: '.box',
// 	  gutterWidth: 0,
// 	  // set columnWidth a fraction of the container width
// 	  columnWidth: function( containerWidth ) {
// 	    return 226;
// 	  }
// 	}).imagesLoaded(function() { $('#masonry-container').masonry('reload');
// 		});
// });

$(document).ready(function(){
      var $container = $('#masonry-container');
      $container.imagesLoaded( function(){
        $container.masonry({
          itemSelector: '.box',
          gutterWidth: 0,
          columnWidth: function( containerWidth ) {
	    	return 226;
		  }
        });
      });
});
</script>
